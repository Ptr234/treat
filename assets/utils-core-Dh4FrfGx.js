import{e as m}from"./utils-system-DYl7h-0K.js";import{j as l}from"./vendor-react-DKSiDIWS.js";class f{constructor(){this.encryptionKey=null,this.initializeEncryption()}async initializeEncryption(){try{const e=sessionStorage.getItem("_tk");if(e)this.encryptionKey=await this.importKey(e);else{this.encryptionKey=await this.generateKey();const t=await this.exportKey(this.encryptionKey);sessionStorage.setItem("_tk",t)}}catch{this.encryptionKey=null}}async generateKey(){return await crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}async exportKey(e){const t=await crypto.subtle.exportKey("raw",e);return Array.from(new Uint8Array(t)).map(r=>r.toString(16).padStart(2,"0")).join("")}async importKey(e){const t=new Uint8Array(e.match(/.{2}/g).map(r=>parseInt(r,16)));return await crypto.subtle.importKey("raw",t,{name:"AES-GCM"},!1,["encrypt","decrypt"])}async encrypt(e){if(!this.encryptionKey)return btoa(e);try{const r=new TextEncoder().encode(e),a=crypto.getRandomValues(new Uint8Array(12)),s=await crypto.subtle.encrypt({name:"AES-GCM",iv:a},this.encryptionKey,r),i=new Uint8Array(a.length+s.byteLength);return i.set(a),i.set(new Uint8Array(s),a.length),Array.from(i).map(n=>n.toString(16).padStart(2,"0")).join("")}catch{return btoa(e)}}async decrypt(e){if(!this.encryptionKey)try{return atob(e)}catch{return null}try{const t=new Uint8Array(e.match(/.{2}/g).map(n=>parseInt(n,16))),r=t.slice(0,12),a=t.slice(12),s=await crypto.subtle.decrypt({name:"AES-GCM",iv:r},this.encryptionKey,a);return new TextDecoder().decode(s)}catch{try{return atob(e)}catch{return null}}}async setToken(e){if(!e){this.removeToken();return}try{const t=await this.encrypt(e);sessionStorage.setItem("_auth",t),document.cookie=`auth_session=${t}; Secure; SameSite=Strict; Path=/; Max-Age=86400`,localStorage.removeItem("authToken"),this.setTokenExpiration()}catch{throw new Error("Token storage failed")}}async getToken(){try{const e=sessionStorage.getItem("_auth");if(e){const r=await this.decrypt(e);if(r&&this.isTokenValid(r))return r}const t=this.getTokenFromCookie();if(t){const r=await this.decrypt(t);if(r&&this.isTokenValid(r))return r}return this.removeToken(),null}catch{return this.removeToken(),null}}getTokenFromCookie(){const e=document.cookie.split(";");for(const t of e){const[r,a]=t.trim().split("=");if(r==="auth_session")return a}return null}isTokenValid(e){if(!e||typeof e!="string")return!1;try{const t=e.split(".");if(t.length!==3)return!1;const r=JSON.parse(atob(t[1])),a=Math.floor(Date.now()/1e3);return r.exp&&r.exp>a}catch{return!1}}removeToken(){sessionStorage.removeItem("_auth"),sessionStorage.removeItem("_tk"),document.cookie="auth_session=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",localStorage.removeItem("authToken"),this.clearTokenExpiration()}setTokenExpiration(){this.clearTokenExpiration(),this.expirationTimer=setTimeout(()=>{this.removeToken(),window.dispatchEvent(new CustomEvent("tokenExpired"))},1440*60*1e3)}clearTokenExpiration(){this.expirationTimer&&(clearTimeout(this.expirationTimer),this.expirationTimer=null)}isSecureStorageAvailable(){return window.isSecureContext&&typeof crypto<"u"&&crypto.subtle!==void 0}getSecurityStatus(){return{secureContext:window.isSecureContext,cryptoAvailable:typeof crypto<"u",encryptionEnabled:this.encryptionKey!==null,storageMethod:this.encryptionKey?"encrypted":"base64-fallback",tokenPresent:!!sessionStorage.getItem("_auth"),httpsEnabled:location.protocol==="https:"}}}const x=new f,I=(o,e,t=null,r={})=>{const{offset:a=100,behavior:s="smooth",block:i="start",replace:n=!1}=r;try{if(t){const c=`${e}#${t}`;o(c,{replace:n}),setTimeout(()=>{const u=document.getElementById(t);if(u){const d=u.getBoundingClientRect().top+window.pageYOffset-a;window.scrollTo({top:d,behavior:s})}},100)}else o(e,{replace:n})}catch{window.location.href=t?`${e}#${t}`:e}};class y{constructor(){this.retryAttempts=3,this.retryDelay=1e3,this.timeoutDuration=1e4,this.fallbackEnabled=!0}async safeExecute(e,t=null,r="Unknown"){for(let a=1;a<=this.retryAttempts;a++)try{const s=new Promise((n,c)=>{setTimeout(()=>c(new Error("Operation timeout")),this.timeoutDuration)});return{success:!0,data:await Promise.race([Promise.resolve(e()),s]),error:null}}catch(s){if(m.logError({type:"NETWORK_ERROR",message:`Network operation failed in ${r} (attempt ${a}/${this.retryAttempts}): ${s.message}`,context:r,attempt:a,originalError:s.toString()},"NETWORK"),a===this.retryAttempts)if(t&&this.fallbackEnabled)try{return{success:!0,data:await t(),error:null,usedFallback:!0}}catch{return{success:!1,data:null,error:this.createUserFriendlyError(s,r),originalError:s}}else return{success:!1,data:null,error:this.createUserFriendlyError(s,r),originalError:s};await this.delay(this.retryDelay*a)}}createUserFriendlyError(e,t){const r=e.message?.toLowerCase()||"";return r.includes("network")||r.includes("fetch")?`Connection issue while ${t.toLowerCase()}. Please check your internet connection and try again.`:r.includes("timeout")?`Request took too long while ${t.toLowerCase()}. Please try again.`:r.includes("cors")||r.includes("cross-origin")?"Security restriction encountered. Please refresh the page and try again.":r.includes("404")||r.includes("not found")?"The requested resource was not found. Please try again later.":r.includes("500")||r.includes("server error")?"Server is temporarily unavailable. Please try again in a few moments.":r.includes("403")||r.includes("unauthorized")?"Access denied. Please check your permissions and try again.":`An unexpected error occurred while ${t.toLowerCase()}. Please try again.`}async safeFetch(e,t={},r="fetching data"){const a=async()=>{const i=await fetch(e,{...t,timeout:this.timeoutDuration,headers:{"Content-Type":"application/json",...t.headers}});if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);return await i.json()},s=async()=>{const i=`fallback_${btoa(e).slice(0,20)}`,n=localStorage.getItem(i);if(n)return JSON.parse(n);throw new Error("No fallback available")};return await this.safeExecute(a,s,r)}wrapAsync(e,t="executing operation"){return async(...r)=>{const a=()=>e(...r),s=await this.safeExecute(a,null,t);if(!s.success)throw new Error(s.error);return s.data}}wrapPromise(e,t="processing promise"){return this.safeExecute(()=>e,null,t)}wrapEventHandler(e,t="handling event"){return async(...r)=>{try{e.constructor.name==="AsyncFunction"?await e(...r):e(...r)}catch(a){m.logError({type:"EVENT_HANDLER_ERROR",message:`Event handler failed in ${t}: ${a.message}`,context:t,originalError:a.toString()},"EVENT")}}}delay(e){return new Promise(t=>setTimeout(t,e))}setRetryAttempts(e){this.retryAttempts=Math.max(1,e)}setRetryDelay(e){this.retryDelay=Math.max(100,e)}setTimeout(e){this.timeoutDuration=Math.max(1e3,e)}enableFallback(e=!0){this.fallbackEnabled=e}preventNetworkErrors(){typeof window<"u"&&window.fetch&&(window.fetch=async(e,t={})=>{const r=await this.safeFetch(e,t,`fetching ${e}`);if(!r.success)throw new Error(r.error);return r.data}),typeof window<"u"&&window.addEventListener("unhandledrejection",e=>{e.preventDefault(),m.logError({type:"UNHANDLED_PROMISE_REJECTION",message:`Unhandled promise rejection: ${e.reason}`,reason:e.reason?.toString()||"Unknown"},"PROMISE"),this.showSafeErrorMessage("A background process encountered an issue. The application will continue to work normally.")})}showSafeErrorMessage(e,t="info"){if(typeof document>"u")return;const r=document.getElementById("safe-error-message");r&&r.remove();const a=document.createElement("div");a.id="safe-error-message",a.style.cssText=`
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: linear-gradient(135deg, #3b82f6, #1d4ed8);
      color: white;
      padding: 12px 16px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      z-index: 9999;
      max-width: 300px;
      font-size: 14px;
      line-height: 1.4;
      cursor: pointer;
      transition: opacity 0.3s ease;
    `,a.innerHTML=`
      <div style="display: flex; align-items: center; gap: 8px;">
        <span style="font-size: 16px;">ℹ️</span>
        <div>${e}</div>
      </div>
    `,a.onclick=()=>a.remove(),document.body.appendChild(a),setTimeout(()=>{a.parentElement&&(a.style.opacity="0",setTimeout(()=>a.remove(),300))},5e3)}}const g=new y;typeof window<"u"&&(g.preventNetworkErrors(),window.networkErrorHandler=g);const p={home:{image:"/images/uganda-map-flag.jpg",fallback:"/images/uganda-business-bg.jpeg",gradient:"from-black/50 via-yellow-800/40 to-red-800/50",alt:"Uganda map with flag - Republic of Uganda investment portal",theme:"uganda-map"},investments:{image:"/images/Tourism.webp",fallback:"/images/lake-bunyonyi-uganda.jpg",gradient:"from-black/45 via-green-800/30 to-blue-800/45",alt:"Beautiful Uganda tourism landscapes - Investment opportunities in Pearl of Africa",theme:"tourism-investment"},services:{image:"/images/Infrastucture.webp",fallback:"/images/uganda-business-bg.jpeg",gradient:"from-black/55 via-blue-800/35 to-gray-800/50",alt:"Uganda infrastructure development - Government services and business support",theme:"infrastructure-services"},calculator:{image:"/images/uganda-kampala-city-view.webp",fallback:"/images/uganda-business-bg.jpeg",gradient:"from-black/60 via-yellow-600/40 to-orange-700/60",alt:"Modern Kampala city view - Tax calculator and financial services",theme:"kampala-calculator"},downloads:{image:"/images/Pride.webp",fallback:"/images/uganda-pearl-africa.jpg",gradient:"from-black/50 via-purple-800/35 to-red-800/50",alt:"Uganda national pride and heritage - Official resources and documentation",theme:"pride-resources"},search:{image:"/images/uganda-kampala-city-view.webp",fallback:"/images/uganda-business-bg.jpeg",gradient:"from-black/55 via-indigo-800/40 to-purple-800/55",alt:"Search Uganda business services and investment opportunities",theme:"search-services"}},w=o=>p[o]||p.home,N=({page:o,children:e,className:t=""})=>{const r=w(o);return l.jsxs("div",{className:`relative min-h-screen ${t}`,children:[l.jsxs("div",{className:"absolute inset-0",children:[l.jsx("img",{src:r.image,alt:r.alt,className:"w-full h-full object-cover opacity-100 transition-opacity duration-500",onError:a=>{r.fallback?a.target.src=r.fallback:a.target.style.display="none"}}),l.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${r.gradient}`})]}),l.jsx("div",{className:"absolute inset-0 opacity-5",children:l.jsx("div",{className:"absolute inset-0 animate-pulse",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.6'%3E%3Ccircle cx='30' cy='30' r='1'/%3E%3Ccircle cx='15' cy='15' r='0.5'/%3E%3Ccircle cx='45' cy='45' r='0.5'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`,animation:"float 20s ease-in-out infinite"}})}),l.jsx("div",{className:"absolute inset-0 opacity-5",children:l.jsx("div",{className:"absolute inset-0",style:{backgroundImage:"linear-gradient(45deg, transparent 49%, rgba(255,255,255,0.03) 49%, rgba(255,255,255,0.03) 51%, transparent 51%), linear-gradient(-45deg, transparent 49%, rgba(255,255,255,0.03) 49%, rgba(255,255,255,0.03) 51%, transparent 51%)",backgroundSize:"20px 20px"}})}),l.jsx("div",{className:"relative z-10",children:e}),l.jsx("style",{jsx:!0,children:`
        @keyframes float {
          0%, 100% { transform: translateY(0px) rotate(0deg); }
          25% { transform: translateY(-10px) rotate(1deg); }
          50% { transform: translateY(-20px) rotate(0deg); }
          75% { transform: translateY(-10px) rotate(-1deg); }
        }
      `})]})};class b{constructor(){this.cacheStatus={supported:!1,totalCaches:0,totalSize:"0 Bytes",caches:[],serviceWorker:null,buildInfo:null,lastUpdate:null},this.init()}async init(){try{this.cacheStatus.supported="caches"in window,"serviceWorker"in navigator&&(await this.updateServiceWorkerStatus(),navigator.serviceWorker.addEventListener("controllerchange",()=>{this.updateServiceWorkerStatus()})),this.startPeriodicUpdates(),this.updateBuildInfo(),await this.updateCacheStatus()}catch{}}async updateCacheStatus(){if(this.cacheStatus.supported)try{const e=await caches.keys();let t=0;const r=[];for(const a of e){const s=await caches.open(a),i=await s.keys();let n=0;for(const c of i){const u=await s.match(c);if(u){const h=await u.clone().arrayBuffer();n+=h.byteLength}}t+=n,r.push({name:a,size:this.formatBytes(n),entries:i.length})}this.cacheStatus.totalCaches=e.length,this.cacheStatus.totalSize=this.formatBytes(t),this.cacheStatus.caches=e,this.cacheStatus.cacheDetails=r,this.cacheStatus.lastUpdate=new Date().toISOString(),await this.optimizeCaches()}catch(e){this.cacheStatus.error=e.message}}async updateServiceWorkerStatus(){if("serviceWorker"in navigator)try{const e=await navigator.serviceWorker.getRegistration();this.cacheStatus.serviceWorker={registered:!!e,active:!!e?.active,waiting:!!e?.waiting,installing:!!e?.installing,scope:e?.scope||"unknown"}}catch{}}updateBuildInfo(){this.cacheStatus.buildInfo={timestamp:window.BUILD_TIMESTAMP||Date.now(),version:window.BUILD_VERSION||"1.0.0",time:new Date(window.BUILD_TIMESTAMP||Date.now()).toLocaleString()}}async optimizeCaches(){this.cacheStatus.totalCaches>10&&await this.cleanupOldCaches();const e=50*1024*1024;this.getTotalSizeBytes()>e&&await this.cleanupLargeCaches()}async cleanupOldCaches(){try{const r=(await caches.keys()).sort().slice(0,-8);for(const a of r)await caches.delete(a);await this.updateCacheStatus()}catch{}}async cleanupLargeCaches(){try{const t=(await caches.keys()).filter(r=>!r.includes("precache")&&!r.includes("runtime"));for(const r of t)await caches.delete(r);await this.updateCacheStatus()}catch{}}async clearAllCaches(){try{const t=(await caches.keys()).map(r=>caches.delete(r));return await Promise.all(t),await this.updateCacheStatus(),!0}catch{return!1}}async hardRefresh(){try{if(await this.clearAllCaches(),"serviceWorker"in navigator){const e=await navigator.serviceWorker.getRegistrations();for(const t of e)await t.unregister()}window.location.reload(!0)}catch{}}startPeriodicUpdates(){setInterval(()=>{this.updateCacheStatus()},300*1e3),setInterval(()=>{this.updateServiceWorkerStatus()},30*1e3)}formatBytes(e){if(e===0)return"0 Bytes";const t=1024,r=["Bytes","KB","MB","GB"],a=Math.floor(Math.log(e)/Math.log(t));return`${parseFloat((e/Math.pow(t,a)).toFixed(2))} ${r[a]}`}getTotalSizeBytes(){const t=this.cacheStatus.totalSize.split(" "),r=parseFloat(t[0]);switch(t[1]){case"KB":return r*1024;case"MB":return r*1024*1024;case"GB":return r*1024*1024*1024;default:return r}}getCacheStatus(){return{...this.cacheStatus}}getDebugInfo(){return null}}const z=new b;class v{constructor(){this.originalConsole={...console},this.isProduction=!0,this.isDebugEnabled=!1,this.disableWarnings(),this.isProduction&&!this.isDebugEnabled&&this.disableConsole()}disableWarnings(){console.warn=()=>{}}disableConsole(){console.log=()=>{},console.info=()=>{},console.debug=()=>{},console.error=(...e)=>{const t=e.map(r=>typeof r=="string"?r.replace(/token|password|secret|key/gi,"[REDACTED]"):"[OBJECT]");this.originalConsole.error("[PROD ERROR]",...t)},console.warn=()=>{}}devLog(e,...t){(!this.isProduction||this.isDebugEnabled)&&this.originalConsole[e](...t)}criticalError(...e){this.originalConsole.error("[CRITICAL]",...e)}restore(){Object.assign(console,this.originalConsole)}}new v;class E{constructor(){this.CACHE_VERSION=`v${Date.now()}`,this.APP_CACHE=`osc-uganda-app-${this.CACHE_VERSION}`,this.STATIC_CACHE=`osc-uganda-static-${this.CACHE_VERSION}`,this.RUNTIME_CACHE=`osc-uganda-runtime-${this.CACHE_VERSION}`,this.API_CACHE=`osc-uganda-api-${this.CACHE_VERSION}`,this.IMAGE_CACHE=`osc-uganda-images-${this.CACHE_VERSION}`,this.strategies={CACHE_FIRST:"cache-first",NETWORK_FIRST:"network-first",STALE_WHILE_REVALIDATE:"stale-while-revalidate",NETWORK_ONLY:"network-only",CACHE_ONLY:"cache-only"},this.cacheConfigs={static:{name:this.STATIC_CACHE,strategy:this.strategies.CACHE_FIRST,maxAge:365*24*60*60*1e3,maxEntries:100},runtime:{name:this.RUNTIME_CACHE,strategy:this.strategies.STALE_WHILE_REVALIDATE,maxAge:1440*60*1e3,maxEntries:50},api:{name:this.API_CACHE,strategy:this.strategies.NETWORK_FIRST,maxAge:600*1e3,maxEntries:30},images:{name:this.IMAGE_CACHE,strategy:this.strategies.CACHE_FIRST,maxAge:720*60*60*1e3,maxEntries:200}},this.metrics={hits:0,misses:0,totalRequests:0,avgResponseTime:0,cacheSize:0},this.init()}async init(){try{return await this.clearOldCaches(),await this.initializeCaches(),this.setupPerformanceMonitoring(),await this.preloadCriticalResources(),this.startBackgroundCacheWarming(),this.startCacheOptimization(),this}catch(e){throw e}}async clearOldCaches(){if("caches"in window)try{const t=(await caches.keys()).filter(a=>a.includes("osc-uganda")&&!a.includes(this.CACHE_VERSION)),r=t.map(a=>caches.delete(a));await Promise.all(r),t.length>0}catch{}}async initializeCaches(){if("caches"in window)try{await Promise.all([caches.open(this.APP_CACHE),caches.open(this.STATIC_CACHE),caches.open(this.RUNTIME_CACHE),caches.open(this.API_CACHE),caches.open(this.IMAGE_CACHE)])}catch{}}async preloadCriticalResources(){const e=["/assets/index.css","/assets/index.js","/images/oneStopCenter-logo.jpeg","/images/uganda-kampala-city-view.webp","https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap","/manifest.json"];try{const t=await caches.open(this.STATIC_CACHE),r=e.map(async a=>{try{const s=await fetch(a);s.ok&&await t.put(a,s.clone())}catch{}});await Promise.allSettled(r)}catch{}}setupPerformanceMonitoring(){"PerformanceObserver"in window&&new PerformanceObserver(t=>{for(const r of t.getEntries())r.transferSize===0&&r.decodedBodySize>0?this.metrics.hits++:this.metrics.misses++,this.metrics.totalRequests++,this.updateMetrics()}).observe({entryTypes:["resource"]})}updateMetrics(){if(this.metrics.totalRequests>0){const e=this.metrics.hits/this.metrics.totalRequests*100}}async startBackgroundCacheWarming(){setTimeout(async()=>{try{const e=["/investments","/services","/tools","/support"].filter(r=>this.isValidCacheUrl(r)),t=await caches.open(this.RUNTIME_CACHE);for(const r of e)try{const a=await fetch(r,{method:"GET",mode:"same-origin",credentials:"same-origin",cache:"no-cache",headers:{"X-Cache-Warming":"true"}});a.ok&&a.headers.get("content-type")?.includes("text/html")&&await t.put(r,a.clone())}catch{}}catch{}},2e3)}startCacheOptimization(){setInterval(async()=>{try{await Promise.all([this.cleanupCache(this.cacheConfigs.static),this.cleanupCache(this.cacheConfigs.runtime),this.cleanupCache(this.cacheConfigs.api),this.cleanupCache(this.cacheConfigs.images)]),this.updateMetrics()}catch{}},600*1e3)}async cacheRequest(e,t,r="runtime"){if(!(!("caches"in window)||!t||!t.ok))try{const a=this.cacheConfigs[r],s=await caches.open(a.name),i=t.clone(),n=new Headers(i.headers);n.set("x-cache-timestamp",Date.now().toString()),n.set("x-cache-type",r),n.set("x-cache-version",this.CACHE_VERSION);const c=new Response(i.body,{status:i.status,statusText:i.statusText,headers:n});await s.put(e,c),await this.cleanupCache(a)}catch{}}async getCachedResponse(e,t="runtime"){if(!("caches"in window))return null;try{const r=this.cacheConfigs[t],a=await caches.open(r.name),s=await a.match(e);if(!s)return null;const i=s.headers.get("x-cache-timestamp");return i&&Date.now()-parseInt(i)>r.maxAge?(await a.delete(e),null):(this.metrics.hits++,s)}catch{return null}}async cleanupCache(e){try{const t=await caches.open(e.name),r=await t.keys();if(r.length>e.maxEntries){const a=r.length-e.maxEntries,s=r.slice(0,a);await Promise.all(s.map(i=>t.delete(i)))}}catch{}}async handleRequest(e,t="stale-while-revalidate"){const r=performance.now();try{switch(t){case this.strategies.CACHE_FIRST:return await this.cacheFirstStrategy(e);case this.strategies.NETWORK_FIRST:return await this.networkFirstStrategy(e);case this.strategies.STALE_WHILE_REVALIDATE:return await this.staleWhileRevalidateStrategy(e);case this.strategies.NETWORK_ONLY:return await fetch(e);case this.strategies.CACHE_ONLY:return await this.getCachedResponse(e);default:return await this.staleWhileRevalidateStrategy(e)}}finally{const a=performance.now();this.metrics.avgResponseTime=(this.metrics.avgResponseTime+(a-r))/2}}async cacheFirstStrategy(e){const t=await this.getCachedResponse(e);if(t)return t;const r=await fetch(e);return await this.cacheRequest(e,r.clone()),r}async networkFirstStrategy(e){try{const t=await fetch(e);return await this.cacheRequest(e,t.clone()),t}catch(t){const r=await this.getCachedResponse(e);if(r)return r;throw t}}async staleWhileRevalidateStrategy(e){const t=await this.getCachedResponse(e),r=fetch(e).then(async a=>(await this.cacheRequest(e,a.clone()),a));return t?(r.catch(()=>{}),t):r}async getCacheStatus(){if(!("caches"in window))return{supported:!1};try{const t=(await caches.keys()).filter(s=>s.includes("osc-uganda")),r=0,a=[];for(const s of t){const n=await(await caches.open(s)).keys();a.push({name:s,entries:n.length,type:this.getCacheType(s)})}return{supported:!0,version:this.CACHE_VERSION,totalCaches:t.length,caches:a,metrics:this.metrics,lastUpdate:new Date().toISOString()}}catch(e){return{supported:!1,error:e.message}}}getCacheType(e){return e.includes("static")?"Static Assets":e.includes("runtime")?"Runtime Data":e.includes("api")?"API Responses":e.includes("images")?"Images":"Application"}async invalidateCache(e){if("caches"in window)try{const t=await caches.keys();for(const r of t)if(r.includes("osc-uganda")){const a=await caches.open(r),s=await a.keys();for(const i of s)i.url.includes(e)&&await a.delete(i)}}catch{}}async clearAllCaches(){if("caches"in window)try{const t=(await caches.keys()).filter(r=>r.includes("osc-uganda"));await Promise.all(t.map(r=>caches.delete(r))),this.metrics={hits:0,misses:0,totalRequests:0,avgResponseTime:0,cacheSize:0},this.showCacheNotification("All caches cleared. Page will refresh for optimal performance.","success"),setTimeout(()=>window.location.reload(),1e3)}catch{this.showCacheNotification("Error clearing caches. Please try again.","error")}}showCacheNotification(e,t="info"){const r=this.sanitizeHtml(e),a=["success","error","warning","info"].includes(t)?t:"info",s=document.createElement("div");s.className="fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg transition-all duration-300 transform translate-x-full opacity-0";const i={success:"bg-green-600 text-white",error:"bg-red-600 text-white",warning:"bg-yellow-600 text-white",info:"bg-blue-600 text-white"};s.className+=` ${i[a]}`;const n=document.createElement("div");n.className="flex items-center space-x-3";const c=document.createElement("div");c.className="flex-shrink-0",c.textContent=a==="success"?"✅":a==="error"?"❌":a==="warning"?"⚠️":"ℹ️";const u=document.createElement("div");u.className="flex-1";const d=document.createElement("p");d.className="text-sm font-medium",d.textContent=r;const h=document.createElement("button");h.className="text-white hover:text-gray-200",h.textContent="✕",h.onclick=()=>s.remove(),u.appendChild(d),n.appendChild(c),n.appendChild(u),n.appendChild(h),s.appendChild(n),document.body.appendChild(s),setTimeout(()=>{s.classList.remove("translate-x-full","opacity-0")},100),setTimeout(()=>{s.classList.add("translate-x-full","opacity-0"),setTimeout(()=>s.remove(),300)},5e3)}sanitizeHtml(e){return typeof e!="string"?"":e.replace(/[<>"']/g,t=>({"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"})[t]||t)}isValidCacheUrl(e){try{return e.startsWith("/")?!0:new URL(e,window.location.origin).origin===window.location.origin}catch{return!1}}validateCacheKey(e){return!(typeof e!="string"||e.length>200||/[<>"'`]/.test(e))}}const C=new E;typeof window<"u"&&(window.enhancedCacheManager=C);class S{constructor(){this.errors=[],this.maxErrors=100,this.sessionId=this.generateSessionId(),this.setupGlobalHandlers()}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}setupGlobalHandlers(){window.addEventListener("error",t=>{this.reportError({type:"javascript_error",message:t.message,filename:t.filename,line:t.lineno,column:t.colno,stack:t.error?.stack,timestamp:new Date().toISOString(),url:window.location.href,userAgent:navigator.userAgent})}),window.addEventListener("unhandledrejection",t=>{this.reportError({type:"promise_rejection",message:t.reason?.message||String(t.reason),stack:t.reason?.stack,timestamp:new Date().toISOString(),url:window.location.href,userAgent:navigator.userAgent})});const e=window.fetch;window.fetch=async(...t)=>{try{const r=await e(...t);return r.ok||this.reportError({type:"network_error",message:`HTTP ${r.status}: ${r.statusText}`,url:t[0],status:r.status,timestamp:new Date().toISOString()}),r}catch(r){throw this.reportError({type:"network_error",message:r.message,url:t[0],stack:r.stack,timestamp:new Date().toISOString()}),r}}}reportError(e){const t={id:this.generateErrorId(),sessionId:this.sessionId,...e,context:this.getContext()};return this.errors.push(t),this.errors.length>this.maxErrors&&this.errors.shift(),this.sendToErrorService(t),t.id}generateErrorId(){return`err_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getContext(){return{timestamp:new Date().toISOString(),url:window.location.href,referrer:document.referrer,userAgent:navigator.userAgent,viewport:`${window.innerWidth}x${window.innerHeight}`,connection:navigator.connection?{effectiveType:navigator.connection.effectiveType,downlink:navigator.connection.downlink,rtt:navigator.connection.rtt}:null,memory:performance.memory?{usedJSHeapSize:performance.memory.usedJSHeapSize,totalJSHeapSize:performance.memory.totalJSHeapSize,jsHeapSizeLimit:performance.memory.jsHeapSizeLimit}:null,localStorage:this.getStorageSummary(localStorage),sessionStorage:this.getStorageSummary(sessionStorage)}}getStorageSummary(e){try{const t=Object.keys(e),r=t.reduce((a,s)=>a+(e.getItem(s)||"").length,0);return{keys:t.length,totalSize:r}}catch{return{error:"Access denied"}}}async sendToErrorService(e){try{const t=JSON.parse(localStorage.getItem("app_errors")||"[]");t.push(e),t.length>50&&t.splice(0,t.length-50),localStorage.setItem("app_errors",JSON.stringify(t))}catch{}}getErrorHistory(){return this.errors}getStoredErrors(){try{return JSON.parse(localStorage.getItem("app_errors")||"[]")}catch{return[]}}clearErrors(){this.errors=[],localStorage.removeItem("app_errors")}exportErrors(){const e={session:this.errors,stored:this.getStoredErrors(),sessionId:this.sessionId,exportTime:new Date().toISOString()},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),r=URL.createObjectURL(t),a=document.createElement("a");a.href=r,a.download=`error-report-${this.sessionId}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r)}logError(e,t={}){return this.reportError({type:"manual_error",message:e,...t,timestamp:new Date().toISOString()})}logNavigationError(e,t){return this.reportError({type:"navigation_error",message:`Navigation failed to ${e}`,route:e,error:t.message,stack:t.stack,timestamp:new Date().toISOString()})}logComponentError(e,t,r){return this.reportError({type:"component_error",message:`Component ${e} crashed`,componentName:e,error:t.message,stack:t.stack,componentStack:r.componentStack,timestamp:new Date().toISOString()})}}new S;class k{constructor(){this.validationRules=new Map,this.customValidators=new Map,this.errorMessages=new Map,this.initializeDefaultRules()}initializeDefaultRules(){this.addRule("ugandaTIN",{pattern:/^\d{10}$/,message:"Uganda TIN must be exactly 10 digits",sanitizer:e=>e.replace(/\D/g,"")}),this.addRule("ugandaPhone",{pattern:/^(\+256|0)[0-9]{9}$/,message:"Invalid Uganda phone number format (+256XXXXXXXXX or 0XXXXXXXXX)",sanitizer:e=>e.replace(/[\s-]/g,"")}),this.addRule("businessName",{pattern:/^[a-zA-Z0-9\s-&.()]{2,100}$/,message:"Business name must be 2-100 characters, letters, numbers, and common business symbols only",sanitizer:e=>e.trim().replace(/\s+/g," ")}),this.addRule("email",{pattern:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"Invalid email format",sanitizer:e=>e.trim().toLowerCase()}),this.addRule("amount",{validator:e=>{const t=parseFloat(e);return!isNaN(t)&&t>=0&&t<=999999999999},message:"Amount must be a positive number under 1 trillion UGX",sanitizer:e=>parseFloat(e.toString().replace(/[,\s]/g,""))}),this.addRule("percentage",{validator:e=>{const t=parseFloat(e);return!isNaN(t)&&t>=0&&t<=100},message:"Percentage must be between 0 and 100",sanitizer:e=>parseFloat(e)}),this.addRule("postalAddress",{pattern:/^[a-zA-Z0-9\s-,.]{5,200}$/,message:"Postal address must be 5-200 characters",sanitizer:e=>e.trim().replace(/\s+/g," ")}),this.addRule("companyRegistrationNumber",{pattern:/^[A-Z0-9-]{5,20}$/,message:"Invalid company registration number format",sanitizer:e=>e.toUpperCase().trim()}),this.addRule("vatNumber",{pattern:/^\d{10}$/,message:"VAT number must be 10 digits",sanitizer:e=>e.replace(/\D/g,"")}),this.addRule("futureDate",{validator:e=>new Date(e)>new Date,message:"Date must be in the future",sanitizer:e=>new Date(e).toISOString().split("T")[0]}),this.addRule("pastDate",{validator:e=>new Date(e)<new Date,message:"Date must be in the past",sanitizer:e=>new Date(e).toISOString().split("T")[0]})}addRule(e,t){this.validationRules.set(e,t)}addCustomValidator(e,t){this.customValidators.set(e,t)}validate(e,t){const r={isValid:!0,errors:{},sanitizedData:{},warnings:[]};for(const[a,s]of Object.entries(t)){const i=e[a],n=this.validateField(a,i,s);n.isValid||(r.isValid=!1,r.errors[a]=n.errors),n.warnings.length>0&&r.warnings.push(...n.warnings),r.sanitizedData[a]=n.sanitizedValue}return r}validateField(e,t,r){const a={isValid:!0,errors:[],warnings:[],sanitizedValue:t};if(this.isEmpty(t))return r.required&&(a.isValid=!1,a.errors.push(`${e} is required`)),a;if(r.sanitizer)a.sanitizedValue=r.sanitizer(t);else if(r.rule&&this.validationRules.has(r.rule)){const s=this.validationRules.get(r.rule);s.sanitizer&&(a.sanitizedValue=s.sanitizer(t))}if(r.rule){const s=this.applyRule(r.rule,a.sanitizedValue);s.isValid||(a.isValid=!1,a.errors.push(s.message))}return r.validator&&(r.validator(a.sanitizedValue)||(a.isValid=!1,a.errors.push(r.message||`Invalid ${e}`))),r.minLength&&a.sanitizedValue.length<r.minLength&&(a.isValid=!1,a.errors.push(`${e} must be at least ${r.minLength} characters`)),r.maxLength&&a.sanitizedValue.length>r.maxLength&&(a.isValid=!1,a.errors.push(`${e} must be no more than ${r.maxLength} characters`)),r.min!==void 0&&parseFloat(a.sanitizedValue)<r.min&&(a.isValid=!1,a.errors.push(`${e} must be at least ${r.min}`)),r.max!==void 0&&parseFloat(a.sanitizedValue)>r.max&&(a.isValid=!1,a.errors.push(`${e} must be no more than ${r.max}`)),r.enum&&!r.enum.includes(a.sanitizedValue)&&(a.isValid=!1,a.errors.push(`${e} must be one of: ${r.enum.join(", ")}`)),this.containsSuspiciousContent(a.sanitizedValue)&&(a.isValid=!1,a.errors.push(`${e} contains suspicious content`),this.logSecurityViolation(e,a.sanitizedValue)),a}applyRule(e,t){const r=this.validationRules.get(e);if(!r)return{isValid:!1,message:`Unknown validation rule: ${e}`};let a=!0;return r.pattern?a=r.pattern.test(t.toString()):r.validator&&(a=r.validator(t)),{isValid:a,message:r.message||`Validation failed for rule: ${e}`}}validateBusinessRegistration(e){const t={businessName:{rule:"businessName",required:!0},ownerName:{pattern:/^[a-zA-Z\s]{2,50}$/,message:"Owner name must be 2-50 characters, letters only",required:!0},businessType:{enum:["sole_proprietorship","partnership","limited_company","ngo"],required:!0},tin:{rule:"ugandaTIN",required:!1},phone:{rule:"ugandaPhone",required:!0},email:{rule:"email",required:!0},address:{rule:"postalAddress",required:!0},sector:{enum:["agriculture","tourism","manufacturing","ict","mining","services","other"],required:!0}};return this.validate(e,t)}validateTaxCalculation(e){const t={calculationType:{enum:["paye","corporate","investment"],required:!0},income:{rule:"amount",required:!0},annualTurnover:{rule:"amount",required:!1},employeeCount:{validator:r=>Number.isInteger(Number(r))&&Number(r)>=0,message:"Employee count must be a non-negative integer",required:!1},vatApplicable:{validator:r=>typeof r=="boolean",message:"VAT applicable must be true or false",required:!0}};return this.validate(e,t)}validateInvestmentData(e){const t={investmentAmount:{rule:"amount",required:!0,min:1e6},sector:{enum:["agriculture","tourism","manufacturing","ict","mining","energy","healthcare"],required:!0},projectDuration:{validator:r=>[3,5,7,10].includes(Number(r)),message:"Project duration must be 3, 5, 7, or 10 years",required:!0},expectedRevenue:{rule:"amount",required:!0},location:{enum:["kampala","central","western","eastern","northern","other"],required:!0},isATMSQualified:{validator:r=>typeof r=="boolean",message:"ATMS qualification must be true or false",required:!0}};return this.validate(e,t)}validateInvoiceData(e){const t={clientName:{rule:"businessName",required:!0},clientTIN:{rule:"ugandaTIN",required:!1},invoiceNumber:{pattern:/^INV\d{4,10}$/,message:"Invoice number must start with INV followed by 4-10 digits",required:!0},items:{validator:a=>Array.isArray(a)&&a.length>0,message:"At least one invoice item is required",required:!0},vatRate:{rule:"percentage",required:!0},dueDate:{rule:"futureDate",required:!0}},r=this.validate(e,t);return e.items&&Array.isArray(e.items)&&e.items.forEach((a,s)=>{const i=this.validateInvoiceItem(a);i.isValid||(r.isValid=!1,r.errors[`item_${s}`]=i.errors)}),r}validateInvoiceItem(e){const t={description:{pattern:/^[a-zA-Z0-9\s-&.()]{2,200}$/,message:"Item description must be 2-200 characters",required:!0},quantity:{validator:a=>Number(a)>0,message:"Quantity must be greater than 0",required:!0},unitPrice:{rule:"amount",required:!0,min:.01},total:{rule:"amount",required:!0}},r=this.validate(e,t);if(r.isValid){const a=Number(e.quantity)*Number(e.unitPrice),s=Number(e.total);Math.abs(a-s)>.01&&(r.isValid=!1,r.errors.total=["Total must equal quantity × unit price"])}return r}containsSuspiciousContent(e){return typeof e!="string"?!1:[/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,/javascript:/gi,/on\w+\s*=/gi,/eval\s*\(/gi,/function\s*\(/gi,/\.innerHTML/gi,/document\./gi,/window\./gi,/<iframe/gi,/<object/gi,/<embed/gi,/vbscript:/gi,/file:\/\//gi,/\bexec\b/gi,/\bselect\b.*\bfrom\b/gi,/\bunion\b.*\bselect\b/gi,/\bdrop\b.*\btable\b/gi,/\bdelete\b.*\bfrom\b/gi,/\binsert\b.*\binto\b/gi,/\bupdate\b.*\bset\b/gi].some(r=>r.test(e))}logSecurityViolation(e,t){typeof window<"u"&&window.securityManager&&window.securityManager.logSuspiciousActivity("form-validation","SUSPICIOUS_INPUT",{field:e,content:t.substring(0,100)})}isEmpty(e){return e==null||e===""||typeof e=="string"&&e.trim()===""||Array.isArray(e)&&e.length===0}sanitizeHTML(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}formatCurrency(e,t="UGX"){return new Intl.NumberFormat("en-UG",{style:"currency",currency:t,minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}formatPhone(e){const t=e.replace(/\D/g,"");return t.startsWith("256")?`+${t}`:t.startsWith("0")?`+256${t.substring(1)}`:e}validateForm(e,t){switch(t){case"business_registration":return this.validateBusinessRegistration(e);case"tax_calculation":return this.validateTaxCalculation(e);case"investment":return this.validateInvestmentData(e);case"invoice":return this.validateInvoiceData(e);default:return{isValid:!1,errors:{general:["Unknown validation type"]}}}}generateValidationReport(e){return{timestamp:new Date().toISOString(),summary:{isValid:e.isValid,totalErrors:Object.keys(e.errors).length,totalWarnings:e.warnings.length},details:{errors:e.errors,warnings:e.warnings,sanitizedData:e.sanitizedData},recommendations:this.generateRecommendations(e)}}generateRecommendations(e){const t=[];e.isValid||t.push("Please fix all validation errors before submitting"),e.warnings.length>0&&t.push("Review warnings to ensure data accuracy");const r=Object.keys(e.errors);return r.some(a=>a.includes("phone"))&&t.push("Ensure phone numbers are in Uganda format (+256XXXXXXXXX)"),r.some(a=>a.includes("tin"))&&t.push("TIN should be exactly 10 digits as issued by URA"),r.some(a=>a.includes("email"))&&t.push("Use a valid email address for communication"),t}exportSchema(e){return{business_registration:{businessName:"Business Name (2-100 chars, alphanumeric)",ownerName:"Owner Full Name (2-50 chars, letters only)",businessType:"Type: sole_proprietorship, partnership, limited_company, ngo",tin:"Uganda TIN (10 digits, optional)",phone:"Uganda Phone (+256XXXXXXXXX or 0XXXXXXXXX)",email:"Valid Email Address",address:"Postal Address (5-200 chars)",sector:"Sector: agriculture, tourism, manufacturing, ict, mining, services, other"},tax_calculation:{calculationType:"Type: paye, corporate, investment",income:"Income Amount (UGX, positive number)",annualTurnover:"Annual Turnover (UGX, optional)",employeeCount:"Number of Employees (non-negative integer)",vatApplicable:"VAT Applicable (true/false)"},investment:{investmentAmount:"Investment Amount (UGX, minimum 1,000,000)",sector:"Sector: agriculture, tourism, manufacturing, ict, mining, energy, healthcare",projectDuration:"Duration: 3, 5, 7, or 10 years",expectedRevenue:"Expected Annual Revenue (UGX)",location:"Location: kampala, central, western, eastern, northern, other",isATMSQualified:"ATMS Qualified (true/false)"}}[e]||{}}}const T=new k;typeof window<"u"&&(window.dataValidator=T);export{N as P,I as a,z as b,C as e,g as n,x as s};
